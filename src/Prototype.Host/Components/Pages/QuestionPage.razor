@page "/ask-mario"

@using DriftingBytesLabs.Prototype.Abstractions.Requests
@using Mediator

@rendermode InteractiveServer

@inject IMediator Mediator

<PageTitle>It's-a me, Mario!</PageTitle>
<br/>
<h1>It's-a me, Mario!</h1>
<br/>

<br/>
<RadzenCard>
    <RadzenRow class="rz-mb-10">
        <RadzenTextBox
            @bind-Value=@Question
            />  
        <RadzenButton
            class="btn btn-primary"
            Click="() => AskMario()">
            Ask Mario a question
        </RadzenButton>
    </RadzenRow>
    <RadzenRow class="rz-mb-4">
        <RadzenText
            TextStyle="TextStyle.Subtitle2"
            TagName="TagName.H3">
            Mario says:
        </RadzenText>
    </RadzenRow>
    <RadzenRow class="rz-mb-10">
        <RadzenTextArea
            Value=@Response
            style="width: 100%;"
            Rows="30"
            aria-label="TextArea with placeholder"
            ReadOnly="true"/>
    </RadzenRow>
</RadzenCard>

@code {
    private string Question { get; set; } = "";
    
    private string Response { get; set; } = "";
    
    private async void AskMario()
    {
        Response = string.Empty;

        AskQuestionResponse response = await Mediator.Send
        (
            new AskQuestionRequest(Question)
        );
        
        await foreach (var responsePart in response.Response)
        {
            Response += responsePart;
            StateHasChanged();
        }
    }
}